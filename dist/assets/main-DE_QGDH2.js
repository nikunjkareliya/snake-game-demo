!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=2/1.5,t=4,o=30,n=100,a={coinPerFood:1,coinPerDeath:0,coinPerScoreMultiplier:.1,skinPrices:{neon:0,electric:60,inferno:120,holographic:200,python:300,cosmic:400,circuit:500,crystal:600,phantom:1e3}},i=5,r=2,l=6,s=200,c={foodPerTier:[5,7,10,12,15,18,20,23,25,30],maxTier:10,speedByTier:[120,110,100,90,82,75,70,67,65,63,60],speedMin:50},d={windowBaseSec:6,windowDecayPerTier:.3,windowMin:3,maxFlowTier:4,scoreMultipliers:[1,1.2,1.5,2,3],foodToIncreaseFlow:3,flowColors:["#888888","#00ff00","#00eaff","#ff00ff","#ffaa00"]},f={position:"top-center",offsetX:0,offsetY:20,barWidth:220,barHeight:14,barCornerRadius:7,fontSize:13,fontFamily:"Orbitron, monospace",labelSpacing:10,glowBlur:15,warningPulseSpeed:3,dotRadius:3,dotSpacing:10,dotOffsetY:8,barBackground:"rgba(40, 40, 40, 0.9)",textColor:"#ffffff",warningColor:"#ffaa00"},h=3,u=5,p=2,g=1.5,y=.2,m=3,b=8,S=4,v={color:"#ff0033",glowColor:"#ff6666",glowIntensity:25,pulseSpeed:2,size:.8},k=12,x=80,w=150,M=.6,T="square",C=16,P=100,A=200,B=.5,I="circle",E=.3,$={speed:2,speedTierScaling:.2,maxSpeed:4,color:"#ff3333",glowColor:"#ff8888",radius:24,trailLength:5,trailFadeTime:.3,patrolMinLength:4,patrolMaxLength:8,pulseSpeed:2,gradientRotationSpeed:1.5,glowPulseMin:10,glowPulseMax:30},L=2,O=12,z=5,R={duration:8,coinCount:12,coinLifetime:5,coinValue:5,explosionSpeed:250,flightDuration:.8},W={staticHazardsByTier:[0,3,4,4,5,5,6,7,8,9,10],dynamicHazardsByTier:[0,0,1,1,2,2,1,1,2,2,3]};function q(e){return a.skinPrices[e]??0}const D=1024,H=768,_=Math.max(1,Math.floor(window.devicePixelRatio||1)),G=32,N=Math.floor(32),F=Math.floor(24),X="Up",Y="Down",J="Left",K="Right",V="#00eaff",U="#ff00ff",j=Math.round(11.52),Z=Math.round(1.15*j),Q=2.5,ee="#ffffff",te="#000000",oe="#ff3366",ne="rgba(255, 255, 255, 0.6)",ae="neon",ie=[{id:"neon",name:"Neon",type:"gradient",tier:"basic",get price(){return q("neon")},head:U,tail:V},{id:"electric",name:"Electric",type:"animated",tier:"special",get price(){return q("electric")},colors:{primary:"#00ffff",secondary:"#0099ff",accent:"#ffffff",glow:"#00ddff"},animation:{speed:3,boltFrequency:.15,boltDuration:.08}},{id:"inferno",name:"Inferno",type:"animated",tier:"special",get price(){return q("inferno")},colors:{primary:"#ff4500",secondary:"#ff8c00",accent:"#ffd700",core:"#ffff00"},animation:{speed:2.5,flameHeight:.6,flickerSpeed:15}},{id:"holographic",name:"Holographic",type:"animated",tier:"special",get price(){return q("holographic")},colors:{hueShift:!0,saturation:1,lightness:.6},animation:{speed:1,shimmerSpeed:8}},{id:"python",name:"Python",type:"pattern",tier:"pattern",get price(){return q("python")},colors:{primary:"#000000",secondary:"#ffff00",accent:"#ff0000"},pattern:{type:"stripes",stripeWidth:2,border:!0}},{id:"cosmic",name:"Cosmic",type:"pattern",tier:"special",get price(){return q("cosmic")},colors:{background:"#0a0a2e",nebula1:"#7b2cbf",nebula2:"#240046",stars:"#ffffff"},pattern:{type:"starfield",starCount:40,twinkle:!0}},{id:"circuit",name:"Circuit",type:"pattern",tier:"special",get price(){return q("circuit")},colors:{primary:"#0d1117",lines:"#00ff41",nodes:"#00ffff",glow:"#00ff41"},pattern:{type:"circuit",lineWidth:2,nodeSize:3,pulseSpeed:2}},{id:"crystal",name:"Crystal",type:"special",tier:"special",get price(){return q("crystal")},colors:{primary:"#e0f7ff",secondary:"#a8e6ff",highlight:"#ffffff",sparkle:"#00ffff"},effect:{type:"faceted",facetCount:6,sparkleRate:.2}},{id:"phantom",name:"Phantom",type:"special",tier:"special",get price(){return q("phantom")},colors:{primary:"#b19cd9",secondary:"#7b68ee",glow:"#da70d6",inner:"#e6e6fa"},effect:{type:"ghost",opacity:.6,innerGlow:!0,smokeTrail:!0}}];function re(e){return ie.find(t=>t.id===e)||ie[0]}const le=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;function se(e){return String(Math.floor(e))}function ce(e,t){try{return Number(localStorage.getItem(e)||t)}catch(o){return Number(t)}}function de(e,t){try{return localStorage.setItem(e,t.toString()),!0}catch(o){return!1}}function fe(e,t){try{const o=localStorage.getItem(e);return o?JSON.parse(o):t}catch(o){return t}}function he(e,t){try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(o){return!1}}const ue=ie.filter(e=>0===e.price).map(e=>e.id),pe=fe("neonSnakeOwnedSkins",[]),ge=pe.filter(e=>{const t=ie.find(t=>t.id===e);return t&&(0===t.price||pe.includes(e))}),ye=Array.from(new Set([...ge,...ue]));let me;me=ye,he("neonSnakeOwnedSkins",ye);const be=re(fe("neonSnakeSelectedSkin",ae)),Se=fe("neonSnakeSettings",{soundOn:!0,musicOn:!0,speedMs:120}),ve={gameState:"init",introAnimation:null,score:0,foodCollected:0,highScore:ce("neonSnakeHighScore","0"),currency:ce("neonSnakeCurrency","0"),ownedSkins:me,selectedSkinId:be?.id||ae,currentSkin:be||{head:U,tail:V},snake:[],prevSnake:[],moveProgress:0,direction:K,nextDirection:K,food:{x:10,y:10},settings:Se,speedMs:Se?.speedMs??120,lastTickAt:0,lastFrameAt:0,elapsedSec:0,mouthOpenTimer:0,hitShakeTimer:0,particles:[],foodSparkTimer:0,motionTrailTimer:0,deathTimer:0,growTimer:0,fragments:[],blinkTimer:0,nextBlinkIn:Q+3.5*Math.random(),lastSnakePositions:[],difficultyTier:0,foodCollectedTotal:0,flowTier:0,flowStreak:0,flowTimer:0,flowActive:!1,hazards:[],boosters:[],activeBoosterEffects:[],coinShower:{active:!1,timer:0,spawnTimer:0,coins:[],flyingCoins:[],basketX:0,basketY:0},shrinkRay:{particles:[]},difficulty:{tier:0,speedMs:120,flowWindow:6,nextTierAt:10}},ke=document.getElementById("gameCanvas"),xe=ke.getContext("2d");xe.setTransform(_,0,0,_,0,0),ke.setAttribute("tabindex","0"),ke.addEventListener("click",()=>ke.focus()),setTimeout(()=>ke.focus(),100);const we={},Me=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};const a=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),r=i?.nonce||i?.getAttribute("nonce");n=e(t.map(e=>{if(e=function(e,t){return new URL(e,t).href}(e,o),e in we)return;we[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(o)for(let o=a.length-1;o>=0;o--){const n=a[o];if(n.href===e&&(!t||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${n}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,r&&i.setAttribute("nonce",r),document.head.appendChild(i),t?new Promise((t,o)=>{i.addEventListener("load",t),i.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};function Te(e,t,o,n){const a=document.createElement("div");a.className="flying-coin";const i=40*(Math.random()-.5),r=40*(Math.random()-.5);a.style.left=`${e.left+e.width/2+i}px`,a.style.top=`${e.top+e.height/2+r}px`;const l=t.left+t.width/2-(e.left+e.width/2),s=t.top+t.height/2-(e.top+e.height/2);a.style.setProperty("--end-x",`${l}px`),a.style.setProperty("--end-y",`${s}px`),a.style.setProperty("--curve",-100-50*Math.random()+"px"),a.style.animationDelay=.08*o+"s",document.body.appendChild(a),a.addEventListener("animationend",()=>{a.remove(),o===n-1&&Me(async()=>{const{updateStats:e}=await Promise.resolve().then(()=>Ke);return{updateStats:e}},void 0,import.meta.url).then(({updateStats:e})=>{e()})})}const Ce=document.getElementById("overlay");document.getElementById("score"),document.getElementById("highScore");const Pe=document.getElementById("hudCurrency"),Ae=document.getElementById("foodCollected");let Be,Ie,Ee=0,$e=null;function Le(e,t){Be=e,Ie=t,Ce.classList.add("visible"),document.getElementById("stage-wrap")?.classList.add("overlay-open"),Ce.innerHTML=function(){const e="SNAKE FRENZY",t=Array.from(e).map((e,t)=>" "===e?`<tspan class="title-char spacer" style="--i:${t}">¬†</tspan>`:`<tspan class="title-char" style="--i:${t}">${e}</tspan>`).join("");return`\n        <div class="lobby-bg-particle"></div>\n        <div class="lobby-bg-particle"></div>\n        <div class="lobby-bg-particle"></div>\n        <div class="lobby-bg-particle"></div>\n        <div class="lobby-bg-particle"></div>\n        <div class="lobby-bg-particle"></div>\n        <div class="lobby-bg-particle"></div>\n        <div class="lobby-bg-particle"></div>\n\n        \x3c!-- Settings icon button in top-right corner (visible while overlay shown) --\x3e\n        <button id="lobbySettingsBtn" class="settings-icon-btn glass" aria-label="Settings">‚öôÔ∏è</button>\n\n        <div class="overlay-inner">\n            <svg class="title neon" viewBox="0 0 800 80" preserveAspectRatio="xMidYMid meet" aria-label="SNAKE FRENZY" role="img">\n                <defs>\n                    <linearGradient id="titleGradient" x1="0%" y1="0%" x2="100%" y2="0%">\n                        <stop offset="0%" style="stop-color:#ff00ff;stop-opacity:1">\n                            <animate attributeName="stop-color" values="#ff00ff;#ff0080;#ff00ff" dur="${i}s" repeatCount="indefinite" />\n                        </stop>\n                        <stop offset="100%" style="stop-color:#00eaff;stop-opacity:1">\n                            <animate attributeName="stop-color" values="#00eaff;#00ffaa;#00eaff" dur="${i}s" repeatCount="indefinite" />\n                        </stop>\n                    </linearGradient>\n                </defs>\n                <text class="title-text" x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" fill="url(#titleGradient)" font-family="Audiowide, cursive" font-size="72" letter-spacing="2" font-weight="400">\n                    ${t}\n                </text>\n            </svg>\n            <p class="tagline">Collect. Grow. Survive.</p>\n\n            \x3c!-- High Score Badge (positioned right-center) --\x3e\n            <div class="high-score-badge glass">\n                <div class="badge-content">\n                    <span class="badge-label">HIGHEST SCORE</span>\n                    <span id="lobbyHighScore" class="badge-value">0</span>\n                </div>\n            </div>\n\n            <div class="lobby-menu">\n                <button id="playBtn" class="btn btn-hero neon">Play</button>\n                <div class="button-separator"></div>\n                <div class="secondary-actions">\n                    <button id="customizeBtn" class="btn"><span class="btn-icon">‚ú®</span>Customize</button>\n                    <button id="howToPlayBtn" class="btn"><span class="btn-icon">‚ùì</span>How to Play</button>\n                </div>\n            </div>\n        </div>\n    `}(),Oe();const o=document.getElementById("lobbyHighScore");o&&(o.textContent=se(ve.highScore)),function(e,t){const o=document.getElementById("playBtn");o&&o.addEventListener("click",()=>{"playing"!==ve.gameState&&(e(),t())});const n=document.getElementById("customizeBtn");n&&n.addEventListener("click",()=>{Re(e,t)});const a=document.getElementById("lobbySettingsBtn");a&&a.addEventListener("click",()=>{Ge()});const i=document.getElementById("howToPlayBtn");i&&i.addEventListener("click",()=>{Ce.innerHTML='\n        <div class="how-to-play-dialog glass">\n            <h2>How to Play</h2>\n            \n            <div class="how-to-play-section">\n                <h3>MOVE</h3>\n                <div class="controls-grid">\n                    <div class="key-grid wasd-grid">\n                        <div class="key-icon grid-w">W</div>\n                        <div class="key-icon grid-a">A</div>\n                        <div class="key-icon grid-s">S</div>\n                        <div class="key-icon grid-d">D</div>\n                    </div>\n                    <span class="or-divider">OR</span>\n                    <div class="key-grid arrow-grid">\n                        <div class="key-icon grid-up">‚Üë</div>\n                        <div class="key-icon grid-left">‚Üê</div>\n                        <div class="key-icon grid-down">‚Üì</div>\n                        <div class="key-icon grid-right">‚Üí</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="how-to-play-section">\n                <h3>ACTIONS</h3>\n                <div class="controls-grid">\n                    <div class="key-icon space">SPACE</div>\n                    <span style="margin: 0 10px;">Pause / Resume</span>\n                </div>\n            </div>\n\n            <button id="howToPlayBackBtn" class="btn">Got it!</button>\n        </div>\n    ',Ce.classList.add("visible"),document.getElementById("howToPlayBackBtn").addEventListener("click",()=>{Le(Be,Ie)})})}(e,t),function(){if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;Fe();const e=async()=>{const t=Math.max(2,r),o=Math.max(t+1,l),n=Math.random()*(o-t)+t;await new Promise(e=>$e=setTimeout(e,1e3*n));const a=Array.from(Ce.querySelectorAll(".title-text .title-char:not(.spacer)"));if(0===a.length)return e();const i=a[Math.floor(Math.random()*a.length)];if(!i)return e();const c=s;i.classList.add("flicker");const d=e=>{e.target===i&&(i.classList.remove("flicker"),i.removeEventListener("animationend",d))};i.addEventListener("animationend",d),setTimeout(()=>{i.classList.remove("flicker"),i.removeEventListener("animationend",d)},c+80),Ce.classList.contains("visible")&&e()};e()}()}function Oe(){if(Pe){const e=se(ve.currency);ve.currency!==Ee?(Pe.textContent=e,Pe.parentElement?.classList.add("coin-pop"),setTimeout(()=>{Pe.parentElement?.classList.remove("coin-pop")},400),Ee=ve.currency):Pe.textContent=e}const e=document.getElementById("hudScore");e&&(e.textContent=se(ve.score)),Ae&&(Ae.textContent=ve.foodCollected||0)}function ze(){Ce.classList.remove("visible"),document.getElementById("stage-wrap")?.classList.remove("overlay-open"),Fe(),setTimeout(()=>ke.focus(),50)}function Re(e,t){Ce.classList.add("visible"),function(e,t){Ce.innerHTML=function(){const e=new Set(ve.ownedSkins||[]);return`\n        <div class="customize-dialog glass">\n            <div class="customize-header">\n                <h2 class="customize-heading">Customization</h2>\n            </div>\n            <div class="skin-grid">${ie.map((t,o)=>function(e,t,o=0){const n=t.has(e.id),a=ve.selectedSkinId===e.id,i=n||ve.currency>=e.price,r=n||i?e.name:`${e.name} - Insufficient coins. Need ${e.price-ve.currency} more.`;let l="common";0===e.price?l="free":e.price>=90?l="epic":e.price>=60&&(l="rare");let s="";"gradient"===e.type?s=`background: linear-gradient(90deg, ${e.head}, ${e.tail});`:"animated"===e.type?"electric"===e.id?s=`background: linear-gradient(135deg, ${e.colors.primary}, ${e.colors.secondary});`:"inferno"===e.id?s=`background: linear-gradient(0deg, ${e.colors.primary}, ${e.colors.accent});`:"holographic"===e.id&&(s="background: linear-gradient(90deg, #ff0080, #ff8c00, #40ff00, #00ffff, #8000ff, #ff0080);"):"pattern"===e.type?"python"===e.id?s=`background: repeating-linear-gradient(90deg, ${e.colors.primary} 0px, ${e.colors.primary} 20px, ${e.colors.secondary} 20px, ${e.colors.secondary} 40px);`:"cosmic"===e.id?s=`background: radial-gradient(circle at 30% 50%, ${e.colors.nebula1}, ${e.colors.background});`:"circuit"===e.id&&(s=`background: ${e.colors.primary}; border: 2px solid ${e.colors.lines};`):"special"===e.type&&("crystal"===e.id?s=`background: linear-gradient(135deg, ${e.colors.primary}, ${e.colors.secondary}); position: relative;`:"phantom"===e.id&&(s=`background: radial-gradient(circle, ${e.colors.inner}, ${e.colors.primary}); opacity: 0.85;`));let c="";n&&a?c+='<div class="status-badge equipped-badge" title="Currently equipped">‚≠ê</div>':n||(c+='<div class="status-badge locked-badge" title="Locked">üîí</div>');return`\n      <div class="skin-card glass rarity-${l}" data-skin-id="${e.id}" aria-label="${r}" ${a?'data-equipped="true"':""} ${i?"":'data-locked="true"'} style="animation-delay: ${.05*o}s;">\n        <div class="skin-status-badges">${c}</div>\n        <div class="skin-preview" style="${s}"></div>\n        <div class="skin-name">${e.name}</div>\n        <div class="skin-actions">\n                    ${n?a?'<button class="btn btn-selected" disabled>Selected</button>':'<button class="btn btn-select equipBtn">Select</button>':e.price>0?`<button class="price-chip buyChip" aria-label="Buy ${e.name} for ${e.price} coins"><span class="coin-icon"></span><span class="price-value">${e.price}</span></button>`:""}\n        </div>\n      </div>\n    `}(t,e,o)).join("")}</div>\n            <div style="margin-top: 24px; text-align: center;">\n                <button id="backToLobbyBtn" class="btn">Back to Lobby</button>\n            </div>\n        </div>\n    `}();const o=document.getElementById("lobbyCurrency");o&&(o.textContent=se(ve.currency));const n=document.getElementById("backToLobbyBtn");n&&n.addEventListener("click",()=>Le(e,t));Ce.querySelectorAll("[data-skin-id]").forEach(o=>{const n=o.getAttribute("data-skin-id"),a=o.querySelector(".buyChip"),i=o.querySelector(".equipBtn");Je(o),a&&a.addEventListener("click",()=>qe(n,e,t)),i&&i.addEventListener("click",()=>De(n,e,t))})}(e,t)}function We(e,t,o){const n=Ce.querySelector(`[data-skin-id="${e}"]`);if(!n)return;const a=re(e);if(!a)return;const i=new Set(ve.ownedSkins||[]).has(e),r=ve.selectedSkinId===e,l=n.querySelector(".skin-status-badges");if(l){let e="";i&&r?e='<div class="status-badge equipped-badge" title="Currently equipped">‚≠ê</div>':i||(e='<div class="status-badge locked-badge" title="Locked">üîí</div>'),l.innerHTML=e}const s=n.querySelector(".skin-actions");if(s){let n="";i?n=r?'<button class="btn btn-selected" disabled>Selected</button>':'<button class="btn btn-select equipBtn">Select</button>':a.price>0&&(n=`<button class="price-chip buyChip" aria-label="Buy ${a.name} for ${a.price} coins"><span class="coin-icon"></span><span class="price-value">${a.price}</span></button>`),s.innerHTML=n;const l=s.querySelector(".buyChip"),c=s.querySelector(".equipBtn");l&&l.addEventListener("click",()=>qe(e,t,o)),c&&c.addEventListener("click",()=>De(e,t,o))}r?n.setAttribute("data-equipped","true"):n.removeAttribute("data-equipped"),Je(n);const c=document.getElementById("lobbyCurrency");c&&(c.textContent=se(ve.currency))}function qe(e,t,o,n={}){const a=re(e);if(!a)return;const i=new Set(ve.ownedSkins||[]);if(i.has(e))return;if(a.price>0&&ve.currency<a.price){const t=document.querySelector(`.skin-card[data-skin-id="${e}"]`),o=document.getElementById("ariaLive"),n=a.price-ve.currency;return t&&Ye(t),void(o&&(o.textContent=`Not enough coins. You need ${n} more coins to purchase ${a.name}.`,setTimeout(()=>o.textContent="",3e3)))}a.price>0&&(ve.currency-=a.price),i.add(e),ve.ownedSkins=Array.from(i),de("neonSnakeCurrency",ve.currency),he("neonSnakeOwnedSkins",ve.ownedSkins);const r=document.getElementById("ariaLive");r&&a.price>0&&(r.textContent=`Successfully purchased ${a.name} for ${a.price} coins!`,setTimeout(()=>r.textContent="",3e3)),De(e,t,o,{silent:!0}),n?.silent||function(e,t){ie.forEach(o=>We(o.id,e,t))}(t,o)}function De(e,t,o,n={}){const a=re(e);if(!a)return;if(!new Set(ve.ownedSkins||[]).has(e))return;const i=ve.selectedSkinId;ve.selectedSkinId=e,ve.currentSkin=a,he("neonSnakeSelectedSkin",e),n.silent||(i&&i!==e&&We(i,t,o),We(e,t,o))}document.addEventListener("showGameOver",e=>{Ce.classList.add("visible"),Ce.innerHTML=function(e){const{title:t,score:o,foodEaten:n,coinsEarned:a,highScore:i,isNewHighScore:r}=e;return`\n        \x3c!-- Floating background particles --\x3e\n        <div class="gameover-bg-particle"></div>\n        <div class="gameover-bg-particle"></div>\n        <div class="gameover-bg-particle"></div>\n        <div class="gameover-bg-particle"></div>\n\n        \x3c!-- Game over container --\x3e\n        <div class="gameover-container glass">\n            \x3c!-- Title --\x3e\n            <h1 class="gameover-title neon ${r?"highlight":""}">\n                ${t}\n            </h1>\n\n            \x3c!-- Stats grid --\x3e\n            <div class="gameover-stats">\n                <div class="stat-card glass" style="animation-delay: 0s;">\n                    <div class="stat-icon">üìä</div>\n                    <div class="stat-value neon">${o}</div>\n                    <div class="stat-label">Score</div>\n                </div>\n                <div class="stat-card glass" style="animation-delay: 0.1s;">\n                    <span class="food-sphere-icon stat-icon"></span>\n                    <div class="stat-value neon">${n}</div>\n                    <div class="stat-label">Food Eaten</div>\n                </div>\n                <div class="stat-card glass" style="animation-delay: 0.2s;">\n                    <span class="coin-icon stat-icon"></span>\n                    <div class="stat-value neon">${a}</div>\n                    <div class="stat-label">Coins Earned</div>\n                </div>\n                <div class="stat-card glass" style="animation-delay: 0.3s;">\n                    <div class="stat-icon">üèÜ</div>\n                    <div class="stat-value neon">${i}</div>\n                    <div class="stat-label">High Score</div>\n                </div>\n            </div>\n\n            \x3c!-- Buttons --\x3e\n            <div class="gameover-buttons">\n                <button id="gameoverPlayAgainBtn" class="btn btn-hero neon">Play Again</button>\n                <button id="gameoverBackBtn" class="btn secondary">Back to Lobby</button>\n            </div>\n        </div>\n    `}(e.detail);const t=document.getElementById("gameoverPlayAgainBtn"),o=document.getElementById("gameoverBackBtn");t&&t.addEventListener("click",()=>{Be(),ze()}),o&&o.addEventListener("click",()=>{Le(Be,ze)}),setTimeout(()=>t?.focus(),100),e.detail.coinsEarned>0&&setTimeout(()=>{const t=Ce.querySelector(".stat-card:nth-child(3)");t&&function(e,t){const o=document.querySelector(".corner.left .coin-icon");if(!o||e<=0)return;const n=t.getBoundingClientRect(),a=o.getBoundingClientRect(),i=Math.min(8,Math.max(5,Math.floor(e/3)+3));for(let r=0;r<i;r++)Te(n,a,r,i)}(e.detail.coinsEarned,t)},600)});let He=null,_e=null;function Ge(){He||(He=document.createElement("div"),He.className="modal-backdrop",He.setAttribute("aria-hidden","true"),He.innerHTML='\n            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">\n                <div class="modal-header">\n                    <h2 id="settingsTitle">Settings</h2>\n                    <button id="settingsCloseBtn" class="btn btn-close" aria-label="Close settings">‚úï</button>\n                </div>\n                <div class="modal-body">\n                    <label class="row">\n                        <input id="toggleSound" type="checkbox" />\n                        <span>Sound Effects</span>\n                    </label>\n                    <label class="row">\n                        <input id="toggleMusic" type="checkbox" />\n                        <span>Music</span>\n                    </label>\n                    <div class="danger-zone">\n                        <div class="row column">\n                            <button id="resetProgressBtn" class="btn btn-danger">\n                                Reset Progress\n                            </button>\n                            <div class="hint">Clear all saved data (high score, currency, owned skins)</div>\n                        </div>\n                    </div>\n                </div>\n                <div class="modal-footer centered">\n                    <button id="settingsCancelBtn" class="btn">Cancel</button>\n                    <button id="settingsSaveBtn" class="btn neon">Save</button>\n                </div>\n            </div>\n        ',document.getElementById("stage-wrap").appendChild(He)),_e=document.activeElement;const e=He.querySelector("#toggleSound"),t=He.querySelector("#toggleMusic");e.checked=!!ve.settings?.soundOn,t.checked=!!ve.settings?.musicOn;const o=He.querySelector("#settingsCloseBtn"),n=He.querySelector("#settingsSaveBtn"),a=He.querySelector("#settingsCancelBtn");He.querySelector("#resetProgressBtn").addEventListener("click",()=>{if(confirm("Are you sure you want to reset all progress?\n\nThis will clear:\n‚Ä¢ High score\n‚Ä¢ Currency (coins)\n‚Ä¢ Owned skins\n‚Ä¢ Selected skin\n\nThis action cannot be undone!")){localStorage.removeItem("neonSnakeHighScore"),localStorage.removeItem("neonSnakeCurrency"),localStorage.removeItem("neonSnakeOwnedSkins"),localStorage.removeItem("neonSnakeSelectedSkin");const e=document.getElementById("ariaLive");e&&(e.textContent="Progress reset. Reloading game..."),setTimeout(()=>{window.location.reload()},500)}},{once:!0});He.addEventListener("keydown",e=>{"Escape"===e.key&&Ne(),"Tab"===e.key&&function(e){const t=He.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),o=Array.from(t).filter(e=>!e.hasAttribute("disabled"));if(0===o.length)return;const n=o[0],a=o[o.length-1];e.shiftKey&&document.activeElement===n?(a.focus(),e.preventDefault()):e.shiftKey||document.activeElement!==a||(n.focus(),e.preventDefault())}(e)});const i=()=>Ne();n.addEventListener("click",()=>{const o={soundOn:!!e.checked,musicOn:!!t.checked};ve.settings=o,he("neonSnakeSettings",o),Ne()},{once:!0}),a.addEventListener("click",i,{once:!0}),o.addEventListener("click",i,{once:!0}),He.addEventListener("click",e=>{e.target===He&&i()},{once:!0}),He.classList.add("show"),He.setAttribute("aria-hidden","false");const r=He.querySelector("#toggleSound");setTimeout(()=>r?.focus(),50)}function Ne(){He&&(He.classList.remove("show"),He.setAttribute("aria-hidden","true"),_e&&"function"==typeof _e.focus&&_e.focus())}function Fe(){$e&&(clearTimeout($e),$e=null),Ce.querySelectorAll(".title-char.flicker").forEach(e=>e.classList.remove("flicker"))}const Xe=500;function Ye(e){if(!e||!e.hasAttribute("data-locked"))return;e.classList.add("shake"),e.__shakeGlowTimeout&&clearTimeout(e.__shakeGlowTimeout),e.__shakeGlowTimeout=setTimeout(()=>{e.classList.remove("shake"),e.__shakeGlowTimeout=null},Xe),e.__shakeAnimation&&e.__shakeAnimation.cancel();const t=e.animate([{transform:"translateX(0px)",offset:0},{transform:"translateX(-8px)",offset:.1},{transform:"translateX(8px)",offset:.2},{transform:"translateX(-6px)",offset:.35},{transform:"translateX(6px)",offset:.5},{transform:"translateX(-4px)",offset:.7},{transform:"translateX(4px)",offset:.85},{transform:"translateX(0px)",offset:1}],{duration:Xe,easing:"ease-in-out",iterations:1,composite:"add"});e.__shakeAnimation=t;const o=()=>{e.__shakeAnimation===t&&(e.__shakeAnimation=null)};t.addEventListener("finish",o,{once:!0}),t.addEventListener("cancel",o,{once:!0})}function Je(e){if(!e)return;if(e.__lockedShakeHandler)return;const t=t=>{void 0!==t.button&&0!==t.button||e.hasAttribute("data-locked")&&Ye(e)};e.addEventListener("pointerdown",t),e.__lockedShakeHandler=t}const Ke=Object.freeze(Object.defineProperty({__proto__:null,foodCollectedEl:Ae,hideOverlay:ze,hideSettingsModal:Ne,hudCurrencyEl:Pe,overlay:Ce,showCustomize:Re,showLobby:Le,showSettingsModal:Ge,updateStats:Oe},Symbol.toStringTag,{value:"Module"}));function Ve(e,t){if(!e)return null;if(e.startsWith("rgba("))return e.replace(/rgba\(([^,]+),([^,]+),([^,]+),[^\)]+\)/,`rgba($1,$2,$3,${t})`);if(e.startsWith("rgb("))return e.replace("rgb(","rgba(").replace(")",`, ${t})`);if(e.startsWith("#")){const o=e.replace("#",""),n=parseInt(o,16);return`rgba(${n>>16&255}, ${n>>8&255}, ${255&n}, ${t})`}return e}function Ue(e,t=0){if(!e)return[V,U,"#ffffff"];const o=[];if(e.head&&o.push(e.head),e.tail&&o.push(e.tail),e.colors)for(const i of Object.values(e.colors))"string"==typeof i&&o.push(i);if("animated"===e.type)if("electric"===e.id){const{primary:t,secondary:n,accent:a,glow:i}=e.colors;o.push(t,n,a,Ve(i,.75))}else if("inferno"===e.id){const{primary:t,secondary:n,accent:a,core:i}=e.colors;o.push(t,n,a,i)}else if("holographic"===e.id){const n=t*e.animation.speed*60%360;o.push(`hsl(${n}, 100%, 60%)`,`hsl(${(n+120)%360}, 100%, 55%)`,`hsl(${(n+240)%360}, 100%, 65%)`)}if("pattern"===e.type)if("python"===e.id){const{primary:t,secondary:n,accent:a}=e.colors;o.push(t,n,a)}else if("cosmic"===e.id){const{background:t,nebula1:n,nebula2:a,stars:i}=e.colors;o.push(t,n,a,Ve(i,.7))}else if("circuit"===e.id){const{lines:t,nodes:n,glow:a}=e.colors;o.push(t,Ve(n,.85),a)}if("special"===e.type)if("crystal"===e.id){const{highlight:t,sparkle:n,secondary:a,primary:i}=e.colors;o.push(t,n,a,i)}else if("phantom"===e.id){const{glow:t,inner:n,primary:a,secondary:i}=e.colors;o.push(t,Ve(t,.5),n,a,i)}const n=(a=o,Array.from(new Set(a.filter(Boolean))));var a;return 0===n.length&&n.push(V,U,"#ffffff"),n}function je(e){ve.particles.length>=200&&ve.particles.shift(),ve.particles.push(e)}function Ze(e,t,o,n,a,i={}){const r=i.palette??Ue(ve.currentSkin,ve.elapsedSec);for(let l=0;l<o;l++){const s=l/o*Math.PI*2,c=n+Math.random()*(a-n),d=i.color?i.color:r[Math.floor(Math.random()*r.length)],f=i.shape??(Math.random()<.5?"circle":"square");je({x:e,y:t,vx:Math.cos(s)*c,vy:Math.sin(s)*c,life:i.life??.5+.3*Math.random(),color:d,shape:f,size:i.size??2+2*Math.random()})}}function Qe(){if(nt().total>=b)return;const e=h,t=ve.snake[0];if(!t)return;const o=[];for(let i=0;i<N;i++)for(let n=0;n<F;n++){if(ve.snake.some(e=>e.x===i&&e.y===n))continue;if(ve.food.x===i&&ve.food.y===n)continue;if(Math.abs(i-t.x)+Math.abs(n-t.y)<e)continue;if(Math.abs(i-ve.food.x)+Math.abs(n-ve.food.y)<p)continue;ve.hazards.some(e=>e.x===i&&e.y===n)||o.push({x:i,y:n})}if(0===o.length)return;const n=o[Math.floor(Math.random()*o.length)],a={id:`hazard_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"static",x:n.x,y:n.y,state:"telegraph",age:0,telegraphDuration:g};ve.hazards.push(a);Ze(n.x*G+16,n.y*G+16,k,x,w,{life:M,color:v.glowColor,shape:T,size:3});nt().total}function et(){const e=u,t=ve.snake[0];if(!t)return;if(nt().dynamic>=S)return;const o=[];for(let h=0;h<N;h++)for(let n=3;n<F;n++){if(ve.snake.some(e=>e.x===h&&e.y===n))continue;if(ve.food.x===h&&ve.food.y===n)continue;if(Math.abs(h-t.x)+Math.abs(n-t.y)<e)continue;ve.hazards.some(e=>e.x===h&&e.y===n)||o.push({x:h,y:n})}if(0===o.length)return;const n=o[Math.floor(Math.random()*o.length)],a=Math.random()<.5,i=Math.random()<.5?1:-1,r=$.patrolMinLength+Math.floor(Math.random()*($.patrolMaxLength-$.patrolMinLength+1));let l;if(a){l={minX:Math.max(0,n.x-Math.floor(r/2)),maxX:Math.min(N-1,n.x+Math.floor(r/2)),minY:n.y,maxY:n.y}}else{const e=Math.max(3,n.y-Math.floor(r/2)),t=Math.min(F-1,n.y+Math.floor(r/2));l={minX:n.x,maxX:n.x,minY:e,maxY:t}}const s=$.speed,c=$.speedTierScaling,d=Math.min(s+ve.difficultyTier*c,$.maxSpeed),f={id:`patrol_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"patrol_orb",x:n.x,y:n.y,state:"telegraph",age:0,telegraphDuration:g,velocity:{x:a?i:0,y:a?0:i},patrolBounds:l,speedCellsPerSec:d,lastMoveTime:0,trailPositions:[],blinkTimer:0,nextBlinkIn:2.5+3.5*Math.random()};ve.hazards.push(f);Ze(n.x*G+16,n.y*G+16,k,x,w,{life:M,color:$.glowColor,shape:T,size:3});nt().total}function tt(e,t){e.trailPositions.unshift({x:e.x,y:e.y,age:0}),e.trailPositions.length>$.trailLength&&e.trailPositions.pop();for(const l of e.trailPositions)l.age+=t;e.blinkTimer>0&&(e.blinkTimer=Math.max(0,e.blinkTimer-t)),e.nextBlinkIn=Math.max(0,e.nextBlinkIn-t),e.nextBlinkIn<=0&&(e.blinkTimer=.12,e.nextBlinkIn=2.5+3.5*Math.random()),e.lastMoveTime+=t;const o=e.speedCellsPerSec*t,n=e.x+e.velocity.x*o,a=e.y+e.velocity.y*o;let i=n,r=a;0!==e.velocity.x&&(n<=e.patrolBounds.minX?(i=e.patrolBounds.minX,e.velocity.x=1):n>=e.patrolBounds.maxX&&(i=e.patrolBounds.maxX,e.velocity.x=-1)),0!==e.velocity.y&&(a<=e.patrolBounds.minY?(r=e.patrolBounds.minY,e.velocity.y=1):a>=e.patrolBounds.maxY&&(r=e.patrolBounds.maxY,e.velocity.y=-1)),e.x=i,e.y=r}function ot(e){const t=ve.hazards.findIndex(t=>t.id===e);-1!==t&&ve.hazards.splice(t,1)}function nt(){return{telegraph:ve.hazards.filter(e=>"telegraph"===e.state).length,active:ve.hazards.filter(e=>"active"===e.state).length,total:ve.hazards.length}}let at=null,it=null;function rt(e,t={}){const o=t.style||"info",n=t.color||("warning"===o?"#ff0033":"#00eaff"),a=t.duration||3e3;lt();const i=document.createElement("div");i.className=`notification-banner notification-${o}`,i.textContent=e,i.style.color=n,document.body.appendChild(i),at=i,requestAnimationFrame(()=>{i.classList.add("show")}),it=setTimeout(()=>{lt()},a)}function lt(){it&&(clearTimeout(it),it=null),at&&(at.classList.remove("show"),setTimeout(()=>{at&&at.parentNode&&at.parentNode.removeChild(at),at=null},600))}function st(e){if(ve.coinShower.active){if(ve.coinShower.timer-=e,ve.coinShower.timer<=0)return ve.coinShower.active=!1,ve.coinShower.timer=0,ve.coinShower.spawnTimer=0,void(ve.coinShower.coins=[]);for(let t=ve.coinShower.flyingCoins.length-1;t>=0;t--){const o=ve.coinShower.flyingCoins[t];o.age+=e,o.x+=o.vx*e,o.y+=o.vy*e;const n=.95;if(o.vx*=Math.pow(n,e),o.vy*=Math.pow(n,e),o.age>=o.life){const e=Math.round(o.x/G),n=Math.round(o.y/G),a=Math.max(0,Math.min(N-1,e)),i=Math.max(0,Math.min(F-1,n)),r=ve.snake.some(e=>e.x===a&&e.y===i),l=ve.food.x===a&&ve.food.y===i,s=ve.hazards.some(e=>e.x===a&&e.y===i),c=ve.boosters.some(e=>e.x===a&&e.y===i);r||l||s||c||ve.coinShower.coins.push({x:a,y:i,age:0,life:R.coinLifetime}),ve.coinShower.flyingCoins.splice(t,1);continue}}for(let t=ve.coinShower.coins.length-1;t>=0;t--){const o=ve.coinShower.coins[t];o.age+=e,o.age>=o.life&&ve.coinShower.coins.splice(t,1)}}}function ct(e,t){ve.coinShower.active?ve.coinShower.timer=R.duration:(ve.coinShower.active=!0,ve.coinShower.timer=R.duration,ve.coinShower.spawnTimer=0,ve.coinShower.coins=[],rt("COIN SHOWER ACTIVATED!",{style:"success",duration:2e3,color:"#ffff00"})),ve.coinShower.basketX=e*G+16,ve.coinShower.basketY=t*G+16;for(let o=0;o<R.coinCount;o++){const e=o/R.coinCount*Math.PI*2+(Math.random()-.5)*(.3*Math.PI),t=R.explosionSpeed*(.8+.4*Math.random()),n=Math.cos(e)*t,a=Math.sin(e)*t;ve.coinShower.flyingCoins.push({x:ve.coinShower.basketX,y:ve.coinShower.basketY,vx:n,vy:a,age:0,life:R.flightDuration})}}function dt(e="neonAfterimage"){const t=[],o="shrinkRay"===e,n=o?2:1,a=o?2:1;for(let r=0;r<N;r++)for(let e=0;e<F;e++){if(e<3)continue;if(o&&(r>=N-1||e>=F-1))continue;if(ve.snake.length>0){const t=ve.snake[0];if(Math.abs(t.x-r)+Math.abs(t.y-e)<L)continue}let i=!1;for(let t=r;t<r+n;t++){for(let o=e;o<e+a;o++){if(ve.snake.some(e=>e.x===t&&e.y===o)){i=!0;break}if(ve.food.x===t&&ve.food.y===o){i=!0;break}if(ve.hazards.some(e=>e.x===t&&e.y===o)){i=!0;break}}if(i)break}i||t.push({x:r,y:e})}if(0===t.length)return;const i=t[le(0,t.length-1)];ve.boosters.push({id:Date.now()+Math.random(),type:e,x:i.x,y:i.y,age:0,spawnTime:ve.elapsedSec})}function ft(){const e=ve.snake.length,t=Math.floor(.5*e),o=Math.max(3,e-t),n=e-o;if(n>0){const t=ve.snake[e-1],a=t.x*G+16,i=t.y*G+16;ve.snake.splice(o),ve.prevSnake&&ve.prevSnake.length>o&&ve.prevSnake.splice(o),function(e,t){for(let o=0;o<30;o++){const n=o/30*Math.PI*2+.3*(Math.random()-.5),a=150+100*Math.random();ve.shrinkRay.particles.push({x:e,y:t,vx:Math.cos(n)*a,vy:Math.sin(n)*a,age:0,life:.6,color:"#ff00ff",size:3+3*Math.random()})}}(a,i),rt(`SHRUNK! -${n} SEGMENTS`,{style:"warning",duration:2e3,color:"#ff00ff"})}else rt("SNAKE TOO SHORT!",{style:"warning",duration:1500,color:"#ff00ff"})}const ht=new Map([["ArrowUp",X],["KeyW",X],["w",X],["W",X],["ArrowDown",Y],["KeyS",Y],["s",Y],["S",Y],["ArrowLeft",J],["KeyA",J],["a",J],["A",J],["ArrowRight",K],["KeyD",K],["d",K],["D",K]]);function ut(){const e=[];for(let o=0;o<N;o++)for(let t=0;t<F;t++){if(t<3)continue;if(ve.snake.some(e=>e.x===o&&e.y===t))continue;ve.hazards.some(e=>e.x===o&&e.y===t)||e.push({x:o,y:t})}if(0===e.length)return;const t=e[le(0,e.length-1)];ve.food=t}function pt(){const e=ve.difficultyTier,t=function(e){let t=0,o=0;for(let n=0;n<c.foodPerTier.length&&(o+=c.foodPerTier[n],e>=o);n++)t=n+1;return Math.min(t,c.maxTier)}(ve.foodCollectedTotal),o=function(e){const t=c.speedByTier[e];if(void 0!==t)return Math.max(t,c.speedMin);const o=c.speedByTier[c.speedByTier.length-1];return Math.max(o||60,c.speedMin)}(t),n=function(e){const t=d.windowBaseSec-e*d.windowDecayPerTier;return Math.max(d.windowMin,t)}(t),a=function(e){let t=0;const o=Math.min(e+1,c.maxTier);for(let n=0;n<o&&n<c.foodPerTier.length;n++)t+=c.foodPerTier[n];return t}(t);ve.difficultyTier=t,ve.speedMs=o,ve.difficulty={tier:t,speedMs:o,flowWindow:n,nextTierAt:a},t!==e&&gt(e,t)}function gt(e,t){const o=W.staticHazardsByTier[e]??0,n=W.staticHazardsByTier[t]??0,a=W.dynamicHazardsByTier[e]??0,i=W.dynamicHazardsByTier[t]??0,r=ve.hazards.filter(e=>"static"===e.type).length,l=ve.hazards.filter(e=>"patrol_orb"===e.type).length;nt().total;if(0===o&&n>0&&rt("HAZARDS UNLOCKED!",{style:"warning",duration:3e3}),n>r){const e=n-r;for(let t=0;t<e;t++)Qe()}else if(n<r){yt("static",r-n)}if(0===a&&i>0&&rt("MOVING HAZARDS!",{style:"warning",duration:3e3}),i>l){const e=i-l;for(let t=0;t<e;t++)et()}else if(i<l){yt("patrol_orb",l-i)}}function yt(e,t){const o=ve.hazards.filter(t=>t.type===e).sort((e,t)=>t.age-e.age);for(let n=0;n<t&&n<o.length;n++)ot(o[n].id)}function mt(){ve.flowActive?function(){ve.flowTimer=ve.difficulty.flowWindow,ve.flowStreak++,ve.flowStreak>=d.foodToIncreaseFlow&&ve.flowTier<d.maxFlowTier&&(!function(){ve.flowTier;ve.flowTier=Math.min(ve.flowTier+1,d.maxFlowTier);d.scoreMultipliers[ve.flowTier]}(),ve.flowStreak=0)}():(ve.flowActive=!0,ve.flowTimer=ve.difficulty.flowWindow,ve.flowStreak=1,ve.flowTier=0)}function bt(e){ve.flowActive&&(ve.flowTimer-=e,ve.flowTimer<=0&&function(){ve.flowTier;ve.flowTier=0,ve.flowStreak=0,ve.flowTimer=0,ve.flowActive=!1}())}function St(o){if(!ve.introAnimation)return;const a=ve.introAnimation;if(a.progress+=o/e,a.progress>=1)return ve.gameState="playing",ve.introAnimation=null,ve.score=0,ve.foodCollected=0,ve.particles=[],ve.foodSparkTimer=0,ve.deathTimer=0,ve.mouthOpenTimer=0,ve.hitShakeTimer=0,ve.growTimer=0,ve.hazards=[],function(){const e=Math.floor(N/2),t=Math.floor(F/2);ve.snake=[{x:e,y:t},{x:e-1,y:t},{x:e-2,y:t}],ve.direction=K,ve.nextDirection=K}(),ve.difficultyTier=0,ve.foodCollectedTotal=0,ve.speedMs=c.speedByTier[0],ve.difficulty={tier:0,speedMs:ve.speedMs,flowWindow:d.windowBaseSec,nextTierAt:c.foodPerTier[0]},gt(-1,0),ve.flowTier=0,ve.flowStreak=0,ve.flowTimer=0,ve.flowActive=!1,ve.coinShower.active=!1,ve.coinShower.timer=0,ve.coinShower.spawnTimer=0,ve.coinShower.coins=[],ve.coinShower.flyingCoins=[],ve.shrinkRay.particles=[],ve.boosters=[],ve.activeBoosterEffects=[],ve.prevSnake=ve.snake.map(e=>({...e})),ve.moveProgress=0,ut(),void(ve.lastTickAt=performance.now());const i=a.progress,r=n,l=-160*t,s=ke.height+160*t,f=l+(ke.width+160*t-l)*i+r,h=s+(-160*t-s)*i+r;a.snake.unshift({x:f,y:h}),a.snake.length>a.length&&a.snake.pop();const u=ke.width+160*t,p=-160*t,g=u+(-160*t-u)*i-r,y=p+(ke.height+160*t-p)*i-r;a.snake2.unshift({x:g,y:y}),a.snake2.length>a.length&&a.snake2.pop()}function vt(){if("playing"===ve.gameState||"intro"===ve.gameState)return;ve.score=0,ve.foodCollected=0,ve.particles=[],ve.fragments=[],ve.snake=[],Oe(),ve.gameState="intro";const e=o,a=n,i=-160*t+a,r=ke.height+160*t+a,l=[];for(let t=0;t<e;t++)l.push({x:i,y:r});const s=ke.width+160*t-a,c=-160*t-a,d=[];for(let t=0;t<e;t++)d.push({x:s,y:c});ve.introAnimation={progress:0,length:e,snake:l,snake2:d,scale:t},ve.lastTickAt=performance.now();const f=document.querySelector(".stage-title");f&&f.classList.add("hidden")}function kt(){if("playing"!==ve.gameState&&"paused"!==ve.gameState)return;if(!ve.flowActive)return;xe.save();const e=function(){const{position:e,offsetX:t,offsetY:o,barWidth:n}=f;let a,i;switch(e){case"top-center":default:a=512+t,i=o;break;case"top-right":a=D-n/2-20+t,i=o;break;case"top-left":a=n/2+20+t,i=o}return{x:a,y:i}}(),t=e.x,o=e.y,n=ve.flowTier,a=ve.flowTimer,i=ve.difficulty.flowWindow,r=d.scoreMultipliers[n]||1,l=d.flowColors[n]||d.flowColors[0],s=a<2;!function(e,t,o,n,a){const i=f.barWidth,r=f.barHeight,l=f.barCornerRadius,s=e-i/2,c=t;if(xe.fillStyle=f.barBackground,xt(s,c,i,r,l),xe.fill(),xe.strokeStyle="rgba(255, 255, 255, 0.2)",xe.lineWidth=1,xe.stroke(),o>0){const e=i*o;xe.save(),xe.globalCompositeOperation="lighter";let t=1,d=n;if(a){t=.6+.4*(.5*Math.sin(ve.elapsedSec*f.warningPulseSpeed*Math.PI*2)+.5),d=f.warningColor}xe.shadowColor=d,xe.shadowBlur=f.glowBlur*t,xe.fillStyle=d,xe.save(),xt(s,c,i,r,l),xe.clip(),xt(s,c,e,r,l),xe.fill(),xe.restore(),xe.restore()}}(t,o,Math.max(0,Math.min(1,a/i)),l,s),function(e,t,o,n){const a=d.maxFlowTier,i=f.dotRadius,r=f.dotSpacing,l=t+f.barHeight+f.dotOffsetY,s=e-(a-1)*r/2;xe.shadowBlur=0;for(let c=0;c<a;c++){const e=s+c*r,t=c<o;xe.beginPath(),xe.arc(e,l,i,0,2*Math.PI),t?(xe.fillStyle=n,xe.shadowColor=n,xe.shadowBlur=6,xe.fill(),xe.shadowBlur=0):(xe.strokeStyle="rgba(255, 255, 255, 0.3)",xe.lineWidth=1.5,xe.stroke())}}(t,o,n,l),function(e,t,o,n,a,i,r){const l=f.fontSize,s=f.fontFamily,c=f.barWidth,d=f.barHeight,h=f.labelSpacing;xe.font=`bold ${l}px ${s}`,xe.textBaseline="middle";const u=t+d/2;xe.textAlign="right";const p=`T${o}`;xe.fillStyle=i,xe.shadowColor=i,xe.shadowBlur=8,xe.fillText(p,e-c/2-h,u),xe.textAlign="left";const g=`${n.toFixed(1)}s`,y=`√ó${a.toFixed(1)}`;xe.fillStyle=r?f.warningColor:f.textColor,xe.shadowColor=r?f.warningColor:i,xe.shadowBlur=r?10:6,xe.fillText(g,e+c/2+h,u),xe.font=`bold ${l}px ${s}`;const m=xe.measureText(g).width;xe.fillStyle=i,xe.shadowColor=i,xe.shadowBlur=8,xe.fillText(y,e+c/2+h+m+8,u)}(t,o,n,a,r,l,s),xe.restore()}function xt(e,t,o,n,a){xe.beginPath(),xe.moveTo(e+a,t),xe.lineTo(e+o-a,t),xe.quadraticCurveTo(e+o,t,e+o,t+a),xe.lineTo(e+o,t+n-a),xe.quadraticCurveTo(e+o,t+n,e+o-a,t+n),xe.lineTo(e+a,t+n),xe.quadraticCurveTo(e,t+n,e,t+n-a),xe.lineTo(e,t+a),xe.quadraticCurveTo(e,t,e+a,t),xe.closePath()}function wt(e){const t=e.x*G+16,o=e.y*G+16,n=G*v.size;let a=1,i=1;if("telegraph"===e.state){const t=Math.min(1,e.age/e.telegraphDuration);a=y+t*(1-y),i=.3*Math.sin(e.age*Math.PI*m)+.7,a*=i}else"active"===e.state&&(i=.15*Math.sin(ve.elapsedSec*Math.PI*v.pulseSpeed)+.85,a=i);xe.save(),xe.globalAlpha=a,xe.save(),xe.shadowBlur=v.glowIntensity,xe.shadowColor=v.glowColor,xe.fillStyle=v.color,xe.fillRect(t-n/2,o-n/2,n,n),xe.restore(),"active"===e.state&&(xe.shadowBlur=.6*v.glowIntensity,xe.shadowColor=v.glowColor),xe.fillStyle="telegraph"===e.state?v.glowColor:v.color,xe.fillRect(t-n/2,o-n/2,n,n),xe.strokeStyle="#ffffff",xe.lineWidth=1,xe.globalAlpha=.4*a,xe.strokeRect(t-n/2,o-n/2,n,n),xe.restore()}function Mt(e){const t=e.x*G+16,o=e.y*G+16,n=$.radius;let a=1,i=1;if("telegraph"===e.state){const t=Math.min(1,e.age/e.telegraphDuration);a=y+t*(1-y),i=.3*Math.sin(e.age*Math.PI*m)+.7,a*=i}else"active"===e.state&&(i=.15*Math.sin(ve.elapsedSec*Math.PI*$.pulseSpeed||2)+.85,a=i);if(xe.save(),xe.globalAlpha=a,e.trailPositions&&e.trailPositions.length>0)for(let y=0;y<e.trailPositions.length;y++){const t=e.trailPositions[y],o=$.trailFadeTime,i=Math.min(1,t.age/o),r=a*(1-i)*.4,l=t.x*G+16,s=t.y*G+16,c=n*(1-.5*i);xe.save(),xe.globalAlpha=r,xe.shadowBlur=8,xe.shadowColor=$.glowColor,xe.fillStyle=$.glowColor,xe.beginPath(),xe.arc(l,s,c,0,2*Math.PI),xe.fill(),xe.restore()}const r=.5*Math.sin(ve.elapsedSec*Math.PI*$.pulseSpeed)+.5,l=$.glowPulseMin+r*($.glowPulseMax-$.glowPulseMin);xe.shadowBlur=l,xe.shadowColor=$.glowColor;const s=ve.elapsedSec*$.gradientRotationSpeed,c=6*Math.cos(s),d=6*Math.sin(s),f=xe.createRadialGradient(t-4+c,o-4+d,0,t,o,n),h=.3*Math.sin(.8*ve.elapsedSec)+.7,u=`rgb(${Math.floor(255*h)}, ${Math.floor(51*h)}, ${Math.floor(51*h)})`,p=`rgb(${Math.floor(139*h)}, 0, 0)`,g=`rgb(${Math.floor(30*h)}, 0, 0)`;f.addColorStop(0,u),f.addColorStop(.5,$.color),f.addColorStop(.8,p),f.addColorStop(1,g),xe.fillStyle=f,xe.beginPath(),xe.arc(t,o,n,0,2*Math.PI),xe.fill(),xe.strokeStyle="rgba(0, 0, 0, 0.4)",xe.lineWidth=1.5;for(let y=0;y<4;y++){const e=y*Math.PI/2+s,a=t+Math.cos(e)*n*.3,i=o+Math.sin(e)*n*.3,r=t+Math.cos(e)*n*.9,l=o+Math.sin(e)*n*.9;xe.beginPath(),xe.moveTo(a,i),xe.lineTo(r,l),xe.stroke()}xe.strokeStyle=$.glowColor,xe.lineWidth=2.5,xe.globalAlpha=.8*a,xe.beginPath(),xe.arc(t,o,n,0,2*Math.PI),xe.stroke();let b=0,S=0,v=0,k=0;if(e.velocity){const t=Math.sqrt(e.velocity.x**2+e.velocity.y**2);t>0&&(b=e.velocity.x/t,S=e.velocity.y/t,v=-S,k=b)}const x=Math.max(2,Math.round(.46*n*1.35)),w=.04*n,M=.64*n,T=t+b*w+v*M,C=o+S*w+k*M,P=t+b*w-v*M,A=o+S*w-k*M;if(xe.globalAlpha=a,e.blinkTimer>0){const e=2.4*x;xe.strokeStyle="#4a0000",xe.lineWidth=Math.max(2,.6*x),xe.lineCap="round",xe.beginPath(),xe.moveTo(T-v*e/2,C-k*e/2),xe.lineTo(T+v*e/2,C+k*e/2),xe.moveTo(P-v*e/2,A-k*e/2),xe.lineTo(P+v*e/2,A+k*e/2),xe.stroke()}else{xe.fillStyle="#330000",xe.beginPath(),xe.arc(T,C,x,0,2*Math.PI),xe.fill(),xe.beginPath(),xe.arc(P,A,x,0,2*Math.PI),xe.fill(),xe.fillStyle="#ff6600";const e=.5*x,t=.2*x;xe.beginPath(),xe.arc(T+b*t,C+S*t,e,0,2*Math.PI),xe.fill(),xe.beginPath(),xe.arc(P+b*t,A+S*t,e,0,2*Math.PI),xe.fill()}xe.restore()}function Tt(e,t,o,n,a=!0){a?(xe.shadowBlur=1.8*o,xe.shadowColor="#ffff00"):xe.shadowBlur=0,xe.fillStyle="#ffff00",xe.globalAlpha=.6*n,xe.beginPath(),xe.arc(e,t,o,0,2*Math.PI),xe.fill(),xe.shadowBlur=0,xe.fillStyle="#ffdd00",xe.globalAlpha=.95*n,xe.beginPath(),xe.arc(e,t,.75*o,0,2*Math.PI),xe.fill(),xe.fillStyle="#ffffff",xe.globalAlpha=.7*n,xe.beginPath(),xe.arc(e-.35*o,t-.35*o,.35*o,0,2*Math.PI),xe.fill()}function Ct(e,t,o,n,a){const i=56*o,r=48*o,l=19.2*o;xe.fillStyle="rgba(0, 0, 0, 0.15)",xe.globalAlpha=.5*o,xe.beginPath(),xe.moveTo(e-.5*i-2,t-l+2),xe.lineTo(e+.5*i-2,t-l+2),xe.lineTo(e+.35*i-2,t+l+2),xe.lineTo(e-.35*i-2,t+l+2),xe.closePath(),xe.fill(),xe.shadowBlur=25*o,xe.shadowColor=a,xe.fillStyle=a,xe.globalAlpha=.75*o,xe.beginPath(),xe.moveTo(e-.5*i,t-l),xe.lineTo(e+.5*i,t-l),xe.lineTo(e+.35*i,t+l),xe.lineTo(e-.35*i,t+l),xe.closePath(),xe.fill(),xe.strokeStyle="#cc9900",xe.lineWidth=1,xe.globalAlpha=.3*o;for(let c=1;c<3;c++){const o=t-l+r/3*c,n=e-.5*i+.15*i*c/3,a=e+.5*i-.15*i*c/3;xe.beginPath(),xe.moveTo(n,o),xe.lineTo(a,o),xe.stroke()}xe.strokeStyle="#ffff99",xe.lineWidth=2,xe.globalAlpha=.6*o,xe.beginPath(),xe.moveTo(e-.5*i,t-l),xe.lineTo(e+.5*i,t-l),xe.stroke(),xe.strokeStyle=a,xe.lineWidth=2.5,xe.globalAlpha=.7*o,xe.beginPath(),xe.arc(e,t-16,.45*i,Math.PI,0,!1),xe.stroke(),xe.strokeStyle="#ffff99",xe.lineWidth=1,xe.globalAlpha=.4*o,xe.beginPath(),xe.arc(e-2,t-16,.45*i,Math.PI,0,!1),xe.stroke(),xe.globalAlpha=1;const s=[{x:-.4,y:-.1,size:.3},{x:0,y:0,size:.35},{x:.4,y:-.15,size:.28},{x:-.15,y:.25,size:.32},{x:.25,y:.2,size:.33}];for(const c of s){Tt(e+c.x*i*.5,t+c.y*r,G*c.size,.9*o,!0)}xe.strokeStyle=a,xe.lineWidth=2,xe.globalAlpha=.3*o,xe.beginPath(),xe.ellipse(e,t,.65*i,.75*r,0,0,2*Math.PI),xe.stroke()}function Pt(e,t,o,n,a){const i=44.8,r=41.6;for(let c=0;c<8;c++){const o=2*ve.elapsedSec+c*(2*Math.PI/8),n=35.2,a=e+Math.cos(o)*n,i=t+Math.sin(o)*n;xe.fillStyle="#ffaaff",xe.globalAlpha=.3*(Math.sin(5*ve.elapsedSec+c)+1),xe.beginPath(),xe.arc(a,i,2,0,2*Math.PI),xe.fill()}xe.shadowBlur=40*o,xe.shadowColor=a,xe.globalAlpha=.6*o,xe.fillStyle=a,xe.fillRect(e-22.4,t-20.8,i,r),xe.shadowBlur=0,xe.strokeStyle="#ff99ff",xe.lineWidth=2.5,xe.globalAlpha=.9,xe.beginPath(),xe.moveTo(e-22.4,t+20.8),xe.lineTo(e-.35*i,t-8.32),xe.lineTo(e+.35*i,t-8.32),xe.lineTo(e+22.4,t+20.8),xe.closePath(),xe.stroke(),xe.strokeRect(e-8,t-20.8-8,16,8);const l=xe.createLinearGradient(e,t-20.8,e,t+20.8);l.addColorStop(0,"#ff66ff"),l.addColorStop(1,"#cc00cc"),xe.fillStyle=l,xe.globalAlpha=.8,xe.fillRect(e-.35*i+2,t-6.24,.7*i-4,24.96);const s=[{x:-.2,y:.1,phase:0},{x:0,y:.2,phase:1},{x:.15,y:.05,phase:2}];for(const c of s){const o=t+c.y*r-(30*ve.elapsedSec+20*c.phase)%r,n=e+c.x*i;xe.fillStyle="#ffaaff",xe.globalAlpha=.7,xe.beginPath(),xe.arc(n,o,4,0,2*Math.PI),xe.fill()}xe.fillStyle="#4a3c28",xe.globalAlpha=1,xe.fillRect(e-8-1,t-20.8-8-5,18,6),xe.fillStyle="#ffffff",xe.globalAlpha=.4,xe.beginPath(),xe.arc(e-11.2,t-4.16,.2*i,0,2*Math.PI),xe.fill()}function At(e){switch(e){case"coinShower":default:return"#ffff00";case"shrinkRay":return"#ff00ff";case"gravityWell":return"#00ff00";case"mysteryBox":return"#ff6600";case"mirrorDimension":return"#ff0099"}}function Bt(){xe.fillStyle="rgba(255, 255, 255, 0.1)";for(let e=0;e<H;e+=32)xe.fillRect(0,e,D,1);for(let e=0;e<D;e+=32)xe.fillRect(e,0,1,H)}function It(e,t=8){if(!e||0===e.length)return;if(1===e.length)return xe.beginPath(),void xe.moveTo(e[0].x,e[0].y);if(xe.beginPath(),xe.moveTo(e[0].x,e[0].y),2===e.length)return void xe.lineTo(e[1].x,e[1].y);for(let n=1;n<e.length-1;n++){const o=e[n],a=e[n+1];xe.arcTo(o.x,o.y,a.x,a.y,t)}const o=e[e.length-1];xe.lineTo(o.x,o.y)}function Et(e,t,o,n=1){const a=Z*n,i=1.05*a*(.05*Math.sin(2*ve.elapsedSec)+1),r=ve.currentSkin;let l,s,c;if("gradient"===r.type)l=r.head||U,s=r.tail||V,c=l;else if("animated"===r.type){if("electric"===r.id)l=r.colors.primary,s=r.colors.secondary,c=r.colors.glow;else if("inferno"===r.id)l=r.colors.accent,s=r.colors.primary,c=r.colors.secondary;else if("holographic"===r.id){const e=ve.elapsedSec*r.animation.speed*60%360;l=`hsl(${e}, 100%, 60%)`,s=`hsl(${(e+180)%360}, 100%, 60%)`,c=l}}else if("pattern"===r.type){const e=r.colors||{};l=e.primary||e.nebula1||e.background||e.lines||U,s=e.secondary||e.nebula2||e.background||e.glow||l||V,c=e.accent||e.stars||e.glow||s}else"special"===r.type&&("crystal"===r.id?(l=r.colors.highlight,s=r.colors.secondary,c=r.colors.sparkle):"phantom"===r.id&&(l=r.colors.inner,s=r.colors.primary,c=r.colors.glow));const d=xe.createLinearGradient(e.x-t*a,e.y-o*a,e.x+t*a,e.y+o*a);d.addColorStop(0,l),d.addColorStop(1,s),xe.fillStyle=d,xe.beginPath(),xe.save(),xe.shadowBlur=Math.round(2.8*a),xe.shadowColor=c,xe.beginPath(),xe.arc(e.x,e.y,1.15*i,0,2*Math.PI),xe.fill(),xe.shadowBlur=Math.round(1.2*a),xe.beginPath(),xe.arc(e.x,e.y,.9*i,0,2*Math.PI),xe.fill(),xe.restore();const f=-o,h=t;!function(e,t,o,n,a,i=1){const r=Z*i,l=.04*r,s=.64*r,c=Math.max(2,Math.round(.46*r*1.35)),d={x:e.x+t*l+n*s,y:e.y+o*l+a*s},f={x:e.x+t*l-n*s,y:e.y+o*l-a*s};if(ve.blinkTimer>0){const e=2.4*c;return xe.strokeStyle=te,xe.lineWidth=Math.max(2,.6*c),xe.lineCap="round",xe.beginPath(),xe.moveTo(d.x-n*e/2,d.y-a*e/2),xe.lineTo(d.x+n*e/2,d.y+a*e/2),xe.moveTo(f.x-n*e/2,f.y-a*e/2),xe.lineTo(f.x+n*e/2,f.y+a*e/2),void xe.stroke()}xe.fillStyle=ee,xe.beginPath(),xe.arc(d.x,d.y,c,0,2*Math.PI),xe.fill(),xe.beginPath(),xe.arc(f.x,f.y,c,0,2*Math.PI),xe.fill(),xe.fillStyle=te;const h=.5*c,u=.2*c;xe.beginPath(),xe.arc(d.x+t*u,d.y+o*u,h,0,2*Math.PI),xe.fill(),xe.beginPath(),xe.arc(f.x+t*u,f.y+o*u,h,0,2*Math.PI),xe.fill()}(e,t,o,f,h,n),function(e,t,o,n,a,i=1){const r=Z*i;let l=0;if(ve.mouthOpenTimer>0){const e=1-Math.max(0,Math.min(1,ve.mouthOpenTimer/.45));l=Math.sin(Math.PI*e)}else try{const e=ve.snake&&ve.snake[0],t=ve.food;if(e&&t){const o=t.x-e.x,n=t.y-e.y,a=Math.abs(o)+Math.abs(n),i=function(){const e=ve.direction;return"Up"===e?{x:0,y:-1}:"Down"===e?{x:0,y:1}:"Left"===e?{x:-1,y:0}:{x:1,y:0}}(),r=o*i.x+n*i.y;if(a>0&&a<=2&&r>-1){l=(1===a?.6:.25)*(.6+.4*(.5*Math.sin(8*ve.elapsedSec)+.5))}}}catch(I){l=0}const s=-t,c=-o,d=e.x+s*r*.2,f=e.y+c*r*.2,h=.25*Math.sin(30*ve.elapsedSec)+.75,u=.6*r,p=r*(1+.8*h),g=p*l,y=Math.max(2,u*(.6+.8*l)),m=e.x+s*(.8*r+g),b=e.y+c*(.8*r+g),S=e.x+s*(.8*r+.66*g),v=e.y+c*(.8*r+.66*g),k=Math.max(1,.18*r)*(.6+.4*l),x=d+n*r*.25,w=f+a*r*.25,M=d-n*r*.25,T=f-a*r*.25,C=S+n*k*.8,P=v+a*k*.8,A=S-n*k*.8,B=v-a*k*.8;xe.strokeStyle=te,xe.lineWidth=3*i,xe.beginPath(),xe.moveTo(x,w),xe.quadraticCurveTo(e.x+s*r*.5,e.y+c*r*.5,C,P),xe.moveTo(M,T),xe.quadraticCurveTo(e.x+s*r*.5,e.y+c*r*.5,A,B),xe.stroke(),xe.fillStyle=oe,xe.beginPath(),xe.moveTo(e.x+s*r*.8,e.y+c*r*.8),xe.lineTo(S+n*k,v+a*k),xe.lineTo(m+n*(.5*y),b+a*(.5*y)),xe.lineTo(S-n*k,v-a*k),xe.closePath(),xe.globalAlpha=.95,xe.fill(),xe.globalAlpha=1,xe.fillStyle="rgba(255,255,255,0.6)",xe.beginPath(),xe.arc(m,b,Math.max(1,.35*y),0,2*Math.PI),xe.fill()}(e,t,o,f,h,n)}const $t=new Map([["neon",Lt],["electric",function(e,t,o){const{primary:n,secondary:a,accent:i,glow:r}=o.colors;xe.save(),xe.globalCompositeOperation="lighter",xe.lineCap="round",xe.lineJoin="round",xe.shadowBlur=Math.round(2.5*j),xe.shadowColor=r,xe.strokeStyle=n,xe.lineWidth=2.8*j,It(e,Math.round(.9*j)),xe.stroke(),xe.restore();const l=xe.createLinearGradient(0,0,D,H);l.addColorStop(0,i),l.addColorStop(.5,n),l.addColorStop(1,a),xe.strokeStyle=l,xe.lineWidth=2*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke(),function(e,t){const{accent:o}=t.colors;xe.save(),xe.globalCompositeOperation="lighter",xe.strokeStyle=o,xe.lineWidth=2;for(let n=0;n<e.length-1;n++){if((ve.elapsedSec*t.animation.speed+.7*n)%1<.3){const t=e[n],o=e[n+1],a=(t.x+o.x)/2,i=(t.y+o.y)/2,r=5*ve.elapsedSec+1.3*n,l=.5*Math.sin(2.7*r)*j*.8,s=.5*Math.cos(3.1*r)*j*.8;xe.beginPath(),xe.moveTo(t.x,t.y),xe.lineTo(a+l,i+s),xe.lineTo(o.x,o.y),xe.stroke()}}xe.restore()}(e,o),xe.strokeStyle=i,xe.lineWidth=.3*j,It(e,Math.round(.9*j)),xe.stroke()}],["inferno",function(e,t,o){const{primary:n,secondary:a,accent:i,core:r}=o.colors;xe.save(),xe.globalCompositeOperation="lighter",xe.lineCap="round",xe.lineJoin="round",xe.shadowBlur=Math.round(3*j),xe.shadowColor=i,xe.strokeStyle=n,xe.lineWidth=3.2*j,It(e,Math.round(.9*j)),xe.stroke(),xe.restore(),xe.save(),xe.globalCompositeOperation="lighter",xe.strokeStyle=a,xe.lineWidth=2.4*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke(),xe.restore(),xe.strokeStyle=i,xe.lineWidth=1.6*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke();const l=.3*Math.sin(ve.elapsedSec*o.animation.flickerSpeed)+.7;xe.save(),xe.globalAlpha=l,xe.strokeStyle=r,xe.lineWidth=.8*j,It(e,Math.round(.9*j)),xe.stroke(),xe.restore(),function(e,t){const{accent:o,secondary:n}=t.colors;xe.save(),xe.globalCompositeOperation="lighter";for(let a=0;a<e.length;a+=2){const t=e[a],i=Math.sin(3*ve.elapsedSec+.5*a)*j*.6;xe.fillStyle=a%4==0?o:n,xe.globalAlpha=.6,xe.beginPath(),xe.arc(t.x,t.y+i,.4*j,0,2*Math.PI),xe.fill()}xe.restore()}(e,o)}],["holographic",function(e,t,o){const n=ve.elapsedSec*o.animation.speed*60%360;xe.save(),xe.globalCompositeOperation="lighter",xe.lineCap="round",xe.lineJoin="round";for(let a=0;a<3;a++){const t=`hsl(${(n+30*a)%360}, 100%, 60%)`,o=(3-a)*j*.8;xe.shadowBlur=o,xe.shadowColor=t,xe.strokeStyle=t,xe.lineWidth=j*(2.8-.4*a),xe.globalAlpha=.6-.1*a,It(e,Math.round(.9*j)),xe.stroke()}xe.restore(),xe.save(),xe.globalCompositeOperation="lighter";for(let a=0;a<e.length;a++){const t=e[a],i=(n+20*a)%360,r=.5*Math.sin(ve.elapsedSec*o.animation.shimmerSpeed+.8*a)+.5;xe.fillStyle=`hsl(${i}, 100%, 70%)`,xe.globalAlpha=.5*r,xe.beginPath(),xe.arc(t.x,t.y,.6*j,0,2*Math.PI),xe.fill()}xe.restore()}],["python",function(e,t,o){const{primary:n,secondary:a,accent:i}=o.colors;xe.strokeStyle=n,xe.lineWidth=2.2*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke();const r=o.pattern.stripeWidth;for(let l=0;l<e.length;l++){const s=e[l],c=l===e.length-1&&ve.growTimer>0?t:1,d=Math.floor(l/r)%2;xe.fillStyle=0===d?a:n,xe.beginPath(),xe.arc(s.x,s.y,j*c,0,2*Math.PI),xe.fill(),0===d&&o.pattern.border&&(xe.strokeStyle=i,xe.lineWidth=2,xe.beginPath(),xe.arc(s.x,s.y,j*c*.7,0,2*Math.PI),xe.stroke())}xe.strokeStyle="rgba(255, 255, 255, 0.3)",xe.lineWidth=.15*j,It(e,Math.round(.9*j)),xe.stroke()}],["cosmic",function(e,t,o){const{background:n,nebula1:a,nebula2:i,stars:r}=o.colors;xe.strokeStyle=n,xe.lineWidth=2.4*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke(),xe.save(),xe.globalCompositeOperation="lighter",xe.shadowBlur=Math.round(2*j),xe.shadowColor=a,xe.strokeStyle=a,xe.lineWidth=1.8*j,xe.globalAlpha=.4,It(e,Math.round(.9*j)),xe.stroke(),xe.shadowColor=i,xe.strokeStyle=i,xe.lineWidth=1.4*j,xe.globalAlpha=.3,It(e,Math.round(.9*j)),xe.stroke(),xe.restore(),function(e,t){const{stars:o}=t.colors;for(let n=0;n<e.length;n++){const a=e[n];for(let e=0;e<3;e++){const i=(137.5*n+60*e)*Math.PI/180,r=.6*j*((7*n+13*e)%10)/10,l=a.x+Math.cos(i)*r,s=a.y+Math.sin(i)*r,c=t.pattern.twinkle?.5*Math.sin(4*ve.elapsedSec+.5*n+e)+.5:1;xe.fillStyle=o,xe.globalAlpha=.8*c,xe.beginPath(),xe.arc(l,s,1.5,0,2*Math.PI),xe.fill()}}xe.globalAlpha=1}(e,o)}],["circuit",function(e,t,o){const{primary:n,lines:a,nodes:i,glow:r}=o.colors;xe.strokeStyle=n,xe.lineWidth=2.2*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke(),xe.fillStyle=n;for(let s=0;s<e.length;s++){const o=e[s],n=s===e.length-1&&ve.growTimer>0?t:1;xe.beginPath(),xe.arc(o.x,o.y,j*n,0,2*Math.PI),xe.fill()}xe.save(),xe.globalCompositeOperation="lighter",xe.shadowBlur=Math.round(1.5*j),xe.shadowColor=r;const l=.3*Math.sin(ve.elapsedSec*o.pattern.pulseSpeed)+.7;xe.globalAlpha=l,xe.strokeStyle=a,xe.lineWidth=o.pattern.lineWidth,It(e,Math.round(.9*j)),xe.stroke(),xe.restore();for(let s=0;s<e.length;s++){const t=e[s],n=.5*Math.sin(ve.elapsedSec*o.pattern.pulseSpeed+.3*s)+.5;xe.save(),xe.globalCompositeOperation="lighter",xe.shadowBlur=8,xe.shadowColor=i,xe.fillStyle=i,xe.globalAlpha=n,xe.beginPath(),xe.arc(t.x,t.y,o.pattern.nodeSize,0,2*Math.PI),xe.fill(),xe.restore()}}],["crystal",function(e,t,o){const{primary:n,secondary:a,highlight:i,sparkle:r}=o.colors;xe.save(),xe.globalCompositeOperation="lighter",xe.shadowBlur=Math.round(2*j),xe.shadowColor=r,xe.strokeStyle=a,xe.lineWidth=2.6*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke(),xe.restore();const l=xe.createLinearGradient(0,0,D,H);l.addColorStop(0,i),l.addColorStop(.5,n),l.addColorStop(1,a),xe.strokeStyle=l,xe.lineWidth=2*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke(),function(e,t,o){const{highlight:n}=o.colors;for(let a=0;a<e.length;a++){const i=e[a],r=a===e.length-1&&ve.growTimer>0?t:1;for(let e=0;e<o.effect.facetCount;e++){const t=e/o.effect.facetCount*Math.PI*2,a=.5*j*r,l=i.x+Math.cos(t)*a*.3,s=i.y+Math.sin(t)*a*.3;xe.fillStyle=e%2==0?n:ne,xe.beginPath(),xe.arc(l,s,.15*j,0,2*Math.PI),xe.fill()}}}(e,t,o),function(e,t){const{sparkle:o}=t.colors;xe.save(),xe.globalCompositeOperation="lighter";for(let n=0;n<e.length;n++){const a=(2*ve.elapsedSec+.7*n)%1;if(a<t.effect.sparkleRate){const i=e[n];xe.fillStyle=o,xe.shadowBlur=10,xe.shadowColor=o,xe.globalAlpha=1-a/t.effect.sparkleRate,xe.beginPath(),xe.arc(i.x,i.y,.3*j,0,2*Math.PI),xe.fill()}}xe.restore()}(e,o)}],["phantom",function(e,t,o){const{primary:n,secondary:a,glow:i,inner:r}=o.colors;xe.save(),xe.globalCompositeOperation="lighter",xe.shadowBlur=Math.round(3.5*j),xe.shadowColor=i,xe.strokeStyle=i,xe.lineWidth=3*j,xe.globalAlpha=.5,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke(),xe.restore();const l=xe.createRadialGradient(e[0].x,e[0].y,0,e[0].x,e[0].y,j*e.length*.3);l.addColorStop(0,r),l.addColorStop(.5,n),l.addColorStop(1,a),xe.globalAlpha=o.effect.opacity,xe.strokeStyle=l,xe.lineWidth=2*j,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*j)),xe.stroke(),xe.globalAlpha=1,o.effect.innerGlow&&(xe.save(),xe.globalCompositeOperation="lighter",xe.globalAlpha=.7,xe.strokeStyle=r,xe.lineWidth=.8*j,It(e,Math.round(.9*j)),xe.stroke(),xe.restore());!function(e,t){const{glow:o}=t.colors;xe.save(),xe.globalCompositeOperation="lighter";for(let n=0;n<e.length;n+=2){const t=e[n],a=Math.sin(2*ve.elapsedSec+.7*n)*j*.5,i=.5*Math.sin(3*ve.elapsedSec+n)+.5;xe.fillStyle=o,xe.globalAlpha=.4*i,xe.beginPath(),xe.arc(t.x+.5*a,t.y+a,.5*j,0,2*Math.PI),xe.fill()}xe.restore()}(e,o)}]]);function Lt(e,t,o,n=1){const a=j*n,i=o.head||o.colors?.primary||U,r=o.tail||o.colors?.secondary||V;xe.save(),xe.globalCompositeOperation="lighter",xe.lineCap="round",xe.lineJoin="round",xe.shadowBlur=Math.round(1.8*a),xe.shadowColor=r,xe.strokeStyle=r,xe.lineWidth=2.6*a,It(e,Math.round(.9*a)),xe.stroke(),xe.restore();const l=xe.createLinearGradient(0,0,D,H);l.addColorStop(0,i),l.addColorStop(1,r),xe.strokeStyle=l,xe.lineWidth=2*a,xe.lineCap="round",xe.lineJoin="round",It(e,Math.round(.9*a)),xe.stroke(),xe.strokeStyle="#fff",xe.lineWidth=.22*a,It(e,Math.round(.9*a)),xe.stroke(),xe.save(),xe.globalCompositeOperation="source-over",xe.fillStyle=l;for(let s=0;s<e.length;s++){const t=e[s];xe.beginPath(),xe.arc(t.x,t.y,a,0,2*Math.PI),xe.fill()}xe.restore(),xe.fillStyle="rgba(255, 255, 255, 0.15)";for(let s=1;s<e.length;s+=2){const o=e[s],n=s===e.length-1&&ve.growTimer>0?t:1;xe.beginPath(),xe.arc(o.x,o.y,.6*a*n,0,2*Math.PI),xe.fill()}}function Ot(){const e=xe.createRadialGradient(563.2,345.6,0,512,384,.7*Math.max(D,H));e.addColorStop(0,"rgba(0,0,0,0)"),e.addColorStop(1,"rgba(0,0,0,0.4)"),xe.fillStyle=e,xe.fillRect(0,0,D,H)}const zt=function(){xe.clearRect(0,0,D,H),"intro"===ve.gameState?(Bt(),function(){const e=ve.introAnimation;if(!e||!e.snake||0===e.snake.length)return;const t=e.scale||1,o=e.snake,n=o[0];let a=0,i=0;if(o.length>1){const e=o[1],t=e.x-n.x,r=e.y-n.y,l=Math.sqrt(t*t+r*r);l>0&&(a=t/l,i=r/l)}if(Lt(o,1,{head:U,tail:V},t),Et(n,a,i,t),e.snake2&&e.snake2.length>0){const o=e.snake2,n=o[0];let a=0,i=0;if(o.length>1){const e=o[1],t=e.x-n.x,r=e.y-n.y,l=Math.sqrt(t*t+r*r);l>0&&(a=t/l,i=r/l)}Lt(o,1,{head:V,tail:U},t),Et(n,a,i,t)}}(),Ot()):(Bt(),function(){if(xe.save(),xe.globalCompositeOperation="lighter",ve.fragments&&ve.fragments.length){xe.save(),xe.globalCompositeOperation="source-over";for(const e of ve.fragments){const t=Math.max(0,Math.min(1,e.life/(e.maxLife||1))),o=t,n=.3+.7*t,a=e.size*n;xe.globalAlpha=o,xe.fillStyle=e.color,xe.save(),xe.translate(e.x,e.y),xe.rotate(e.angle||0),xe.fillRect(-a/2,-a/2,a,a),xe.restore(),xe.globalAlpha=.45*o,xe.fillRect(e.x-a,e.y-a,2*a,2*a)}xe.restore()}for(const e of ve.particles){if(e.x<-50||e.x>1074||e.y<-50||e.y>818)continue;const t=Math.min(1,e.life);"circle"===e.shape?(xe.beginPath(),xe.arc(e.x,e.y,e.size,0,2*Math.PI),xe.fillStyle=e.color,xe.globalAlpha=t,xe.fill(),xe.globalAlpha=.5*t,xe.arc(e.x,e.y,2*e.size,0,2*Math.PI),xe.fill()):(xe.save(),xe.translate(e.x,e.y),xe.rotate(e.life*Math.PI),xe.fillStyle=e.color,xe.globalAlpha=t,xe.fillRect(-e.size/2,-e.size/2,e.size,e.size),xe.globalAlpha=.5*t,xe.fillRect(-e.size,-e.size,2*e.size,2*e.size),xe.restore())}for(const e of ve.shrinkRay.particles){const t=1-Math.min(1,e.age/e.life);xe.beginPath(),xe.arc(e.x,e.y,e.size,0,2*Math.PI),xe.fillStyle=e.color,xe.globalAlpha=t,xe.fill(),xe.globalAlpha=.5*t,xe.arc(e.x,e.y,2*e.size,0,2*Math.PI),xe.fill()}xe.restore()}(),function(){for(const e of ve.hazards)"static"===e.type?wt(e):"patrol_orb"===e.type&&Mt(e)}(),function(){if(ve.coinShower.active||0!==ve.coinShower.coins.length||0!==ve.coinShower.flyingCoins.length){xe.save(),xe.globalCompositeOperation="lighter";for(const e of ve.coinShower.flyingCoins){const t=1-e.age/e.life;xe.strokeStyle="#ffff00",xe.lineWidth=1,xe.globalAlpha=.3*t,xe.beginPath(),xe.moveTo(e.x,e.y),xe.lineTo(e.x-.02*e.vx,e.y-.02*e.vy),xe.stroke(),Tt(e.x,e.y,8,t,!0)}for(const e of ve.coinShower.coins){const t=e.x*G+16,o=e.y*G+16,n=e.age/e.life,a=n>.75,i=4*ve.elapsedSec,r=.3*Math.sin(i)+.7,l=a?.4*Math.sin(3*i)+.6:r,s=n<.1?10*n:1-n>.1?1:10*(1-n);xe.save(),xe.globalAlpha=s*l,Tt(t,o,8.96*l,1,!0),xe.restore(),a&&(xe.strokeStyle="#ffff00",xe.lineWidth=1.5,xe.globalAlpha=.2*(Math.sin(8*ve.elapsedSec)+1)*s,xe.beginPath(),xe.arc(t,o,14.4,0,2*Math.PI),xe.stroke())}xe.restore()}}(),function(){if(0!==ve.boosters.length){xe.save(),xe.globalCompositeOperation="lighter";for(const e of ve.boosters){const t=e.x*G+16,o=e.y*G+16,n=O-e.age<z,a=3*ve.elapsedSec,i=.2*Math.sin(a)+.9,r=n?.3*Math.sin(3*a)+.85:i,l=At(e.type);"coinShower"===e.type?Ct(t,o,r,0,l):"shrinkRay"===e.type?Pt(t,o,r,0,l):(xe.shadowBlur=20*r,xe.shadowColor=l,xe.fillStyle=l,xe.globalAlpha=.6*r,xe.beginPath(),xe.arc(t,o,12.8*r,0,2*Math.PI),xe.fill(),xe.shadowBlur=0,xe.globalAlpha=.9*r,xe.beginPath(),xe.arc(t,o,8,0,2*Math.PI),xe.fill()),n&&(xe.strokeStyle=l,xe.lineWidth=2,xe.globalAlpha=.25*(Math.sin(8*ve.elapsedSec)+1),xe.beginPath(),xe.arc(t,o,25.6,0,2*Math.PI),xe.stroke())}xe.restore()}}(),function(){if(!ve.food)return;const e=ve.food.x*G+16,t=ve.food.y*G+16,o=11.2;xe.save(),xe.globalCompositeOperation="lighter";const n=.85+.15*Math.sin(2.8*ve.elapsedSec),a=4*o*n,i=2.8*o*n,r=xe.createRadialGradient(e,t,0,e,t,a);r.addColorStop(0,"rgba(255, 150, 200, 0.8)"),r.addColorStop(.25,"rgba(255, 100, 180, 0.5)"),r.addColorStop(.5,"rgba(255, 0, 150, 0.25)"),r.addColorStop(.75,"rgba(0, 200, 255, 0.15)"),r.addColorStop(1,"rgba(0, 0, 0, 0)"),xe.fillStyle=r,xe.beginPath(),xe.arc(e,t,a,0,2*Math.PI),xe.fill();const l=xe.createRadialGradient(e,t,0,e,t,i);l.addColorStop(0,"rgba(255, 120, 180, 0.9)"),l.addColorStop(.4,"rgba(255, 0, 150, 0.5)"),l.addColorStop(.8,"rgba(0, 200, 255, 0.1)"),l.addColorStop(1,"rgba(0, 0, 0, 0)"),xe.fillStyle=l,xe.beginPath(),xe.arc(e,t,i,0,2*Math.PI),xe.fill(),xe.globalCompositeOperation="source-over";const s=xe.createRadialGradient(e-2.8,t-2.8,1.68,e,t,12.32);s.addColorStop(0,"#ffccff"),s.addColorStop(.2,"#ff99ff"),s.addColorStop(.5,"#ff0099"),s.addColorStop(.85,"#cc0066"),s.addColorStop(1,"#660033"),xe.fillStyle=s,xe.beginPath(),xe.arc(e,t,o*n,0,2*Math.PI),xe.fill();const c=xe.createRadialGradient(e-.35*o,t-.35*o,0,e-.35*o,t-.35*o,5.04);c.addColorStop(0,"rgba(255, 255, 255, 0.85)"),c.addColorStop(.4,"rgba(255, 200, 255, 0.4)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),xe.fillStyle=c,xe.beginPath(),xe.arc(e-2.8,t-2.8,.4*o,0,2*Math.PI),xe.fill(),xe.restore()}(),function(){const e=ve.snake.map((e,t)=>{let o=e.x*G+16,n=e.y*G+16;if(ve.prevSnake&&ve.prevSnake[t]&&ve.moveProgress<1){const e=ve.prevSnake[t],a=e.x*G+16,i=e.y*G+16,r=ve.moveProgress;o=a+(o-a)*r,n=i+(n-i)*r}return{x:o,y:n}});if(0===e.length)return;const t=ve.growTimer>0?1-ve.growTimer/.2:1,o=e[0];let n=0,a=0;if(e.length>1){const t=e[1],i=t.x-o.x,r=t.y-o.y,l=Math.sqrt(i*i+r*r);n=i/l,a=r/l}const i=ve.currentSkin;((i?$t.get(i.id):null)||Lt)(e,t,i),Et(o,n,a)}(),Ot(),"paused"===ve.gameState&&(xe.fillStyle="rgba(0, 0, 0, 0.6)",xe.fillRect(0,0,D,H),xe.save(),xe.font="bold 72px Orbitron, sans-serif",xe.textAlign="center",xe.textBaseline="middle",xe.shadowColor=V,xe.shadowBlur=30,xe.fillStyle=V,xe.fillText("PAUSED",512,364),xe.font="20px Orbitron, sans-serif",xe.shadowBlur=15,xe.fillStyle=ee,xe.fillText("Press SPACE to resume",512,424),xe.restore()),kt())};function Rt(){ve.gameState="dying",ve.deathTimer=1,ve.hitShakeTimer=.5;const e=(t=ve.score,a.coinPerDeath+Math.floor(t*a.coinPerScoreMultiplier));var t;ve.currency+=e,de("neonSnakeCurrency",ve.currency);ve.score>ve.highScore&&(ve.highScore=ve.score,de("neonSnakeHighScore",ve.highScore)),function(){const e=G/3,t=Ue(ve.currentSkin,ve.elapsedSec);for(const o of ve.snake){const n=o.x*G,a=o.y*G;for(let o=0;o<3;o++)for(let i=0;i<3;i++){const o=n+Math.random()*G,i=a+Math.random()*G,r=Math.max(2,Math.round(e*(.35+.6*Math.random()))),l=1.2+1.2*Math.random(),s=t[Math.floor(Math.random()*t.length)],c=Math.random()*Math.PI*2,d=6*(Math.random()-.5),f=8+32*Math.random(),h=Math.random()*Math.PI*2,u=Math.cos(h)*f,p=Math.sin(h)*f;ve.fragments.push({x:o,y:i,size:r,life:l,maxLife:l,color:s,angle:c,angularVelocity:d,vx:u,vy:p})}}ve.snake=[]}()}function Wt(){ve.direction=ve.nextDirection;const e={...ve.snake[0]};if(ve.direction===X&&(e.y-=1),ve.direction===Y&&(e.y+=1),ve.direction===J&&(e.x-=1),ve.direction===K&&(e.x+=1),e.x<0||e.x>=N||e.y<0||e.y>=F)Rt();else if(ve.snake.some(t=>t.x===e.x&&t.y===e.y))Rt();else{if(t=e,ve.hazards.some(e=>{if("active"!==e.state)return!1;if("static"===e.type)return e.x===t.x&&e.y===t.y;if("patrol_orb"===e.type){const o=e.x-t.x,n=e.y-t.y;return o*o+n*n<.49}return!1}))return ve.hitShakeTimer=E,void Rt();var t;if(ve.snake.unshift(e),e.x===ve.food.x&&e.y===ve.food.y){ve.foodCollectedTotal++,ve.foodCollected=ve.foodCollectedTotal,pt(),mt();const t=10,o=d.scoreMultipliers[ve.flowTier]||1,n=Math.floor(t*o);ve.score+=n,ve.currency+=a.coinPerFood,de("neonSnakeCurrency",ve.currency),Oe(),ut(),Dt(e),ve.growTimer=.2}else{let t=!1;for(let o=ve.boosters.length-1;o>=0;o--){const n=ve.boosters[o];let a=!1;if(a="shrinkRay"===n.type?!(e.x!==n.x&&e.x!==n.x+1||e.y!==n.y&&e.y!==n.y+1):e.x===n.x&&e.y===n.y,a){"coinShower"===n.type?ct(n.x,n.y):"shrinkRay"===n.type&&ft(),Dt(e),ve.boosters.splice(o,1),t=!0;break}}if(ve.coinShower.active){(function(e,t){for(let o=ve.coinShower.coins.length-1;o>=0;o--){const n=ve.coinShower.coins[o];if(n.x===e&&n.y===t)return ve.currency+=R.coinValue,de("neonSnakeCurrency",ve.currency),ve.coinShower.coins.splice(o,1),!0}return!1})(e.x,e.y)&&Ze(e.x*G+16,e.y*G+16,3,"#ffff00")}t||ve.snake.pop()}}}function qt(e){for(let t=ve.particles.length-1;t>=0;t--){const o=ve.particles[t];o.x+=o.vx*e,o.y+=o.vy*e,o.life-=e,o.life<=0&&ve.particles.splice(t,1)}if("playing"===ve.gameState&&ve.snake.length>0&&(ve.motionTrailTimer+=e,ve.motionTrailTimer>=.05&&(ve.motionTrailTimer=0,function(){if(0===ve.snake.length)return;const e=ve.snake[0];let t=e.x*G+16,o=e.y*G+16;if(ve.prevSnake&&ve.prevSnake[0]&&ve.moveProgress<1){const e=ve.prevSnake[0],n=e.x*G+16,a=e.y*G+16,i=ve.moveProgress;t=n+(t-n)*i,o=a+(o-a)*i}je({x:t+(Math.random()-.5)*G*.5,y:o+(Math.random()-.5)*G*.5,vx:20*(Math.random()-.5),vy:20*(Math.random()-.5),life:.2,color:Math.random()<.5?ve.currentSkin.head:ve.currentSkin.tail,shape:"circle",size:3})}())),ve.fragments&&ve.fragments.length)for(let t=ve.fragments.length-1;t>=0;t--){const o=ve.fragments[t];o.life-=e,o.angularVelocity&&(o.angle+=o.angularVelocity*e),o.vx&&(o.x+=o.vx*e),o.vy&&(o.y+=o.vy*e),o.life<=0&&ve.fragments.splice(t,1)}}function Dt(e){const t=e.x*G+16,o=e.y*G+16;Ze(t,o,20,100,200,{life:.6+.4*Math.random(),size:3+3*Math.random()});for(let n=0;n<8;n++){const e=300;Ze(t,o,1,e,e,{life:.3,size:5,color:"#ffffff",shape:"circle"})}ve.mouthOpenTimer=ve.mouthOpenTimer||0,ve.mouthOpenTimer=Math.max(ve.mouthOpenTimer,.45)}var Ht,_t;Ht=vt,_t=function(){"playing"===ve.gameState?ve.gameState="paused":"paused"===ve.gameState&&(ve.gameState="playing",ve.lastTickAt=performance.now())},document.addEventListener("keydown",e=>{if("Space"===e.code)return _t(),void e.preventDefault();if("KeyR"===e.code)return Ht(),void e.preventDefault();if("KeyH"===e.code&&"playing"===ve.gameState)return Qe(),void e.preventDefault();if("playing"===ve.gameState)switch(e.code){case"Digit1":return dt("coinShower"),void e.preventDefault();case"Digit2":return dt("shrinkRay"),void e.preventDefault();case"Digit3":return dt("gravityWell"),void e.preventDefault();case"Digit4":return dt("mysteryBox"),void e.preventDefault();case"Digit5":return dt("mirrorDimension"),void e.preventDefault()}const t=ht.get(e.code);var o,n;t&&(o=ve.direction,n=t,o===X&&n===Y||o===Y&&n===X||o===J&&n===K||o===K&&n===J||(ve.nextDirection=t),e.preventDefault())}),Le(vt,ze),requestAnimationFrame(function e(t){requestAnimationFrame(e),ve.lastFrameAt||(ve.lastFrameAt=t);const o=Math.min(.033,Math.max(.001,(t-ve.lastFrameAt)/1e3));if(ve.lastFrameAt=t,ve.elapsedSec+=o,qt(o),ve.mouthOpenTimer>0&&(ve.mouthOpenTimer=Math.max(0,ve.mouthOpenTimer-o)),ve.hitShakeTimer>0&&(ve.hitShakeTimer=Math.max(0,ve.hitShakeTimer-o)),ve.growTimer>0&&(ve.growTimer=Math.max(0,ve.growTimer-o)),ve.blinkTimer>0&&(ve.blinkTimer=Math.max(0,ve.blinkTimer-o)),"playing"===ve.gameState&&(ve.nextBlinkIn=Math.max(0,ve.nextBlinkIn-o),ve.nextBlinkIn<=0&&ve.snake.length>0&&(ve.blinkTimer=.12,ve.nextBlinkIn=Q+3.5*Math.random())),"intro"===ve.gameState)St(o);else if("playing"===ve.gameState){!function(e){for(const t of ve.hazards)t.age+=e,"patrol_orb"===t.type&&tt(t,e),"telegraph"===t.state&&t.age>=t.telegraphDuration&&(t.state="active",Ze(t.x*G+16,t.y*G+16,C,P,A,{life:B,color:$.color,shape:I,size:4}))}(o),bt(o),function(e){for(let t=ve.boosters.length-1;t>=0;t--){const o=ve.boosters[t];o.age+=e,o.age>=O&&ve.boosters.splice(t,1)}}(o),st(o),function(e){for(let t=ve.shrinkRay.particles.length-1;t>=0;t--){const o=ve.shrinkRay.particles[t];o.x+=o.vx*e,o.y+=o.vy*e,o.vx*=.95,o.vy*=.95,o.age+=e,o.age>=o.life&&ve.shrinkRay.particles.splice(t,1)}}(o);const e=t-ve.lastTickAt;ve.moveProgress=Math.min(1,e/ve.speedMs),e>=ve.speedMs&&(ve.lastTickAt=t,ve.prevSnake=ve.snake.map(e=>({...e})),Wt(),ve.moveProgress=0)}else"dying"===ve.gameState&&(ve.deathTimer-=o,ve.deathTimer<=0&&function(){const e=Math.floor(ve.score/10),t=ve.score>ve.highScore;ve.gameState="gameover";const o=document.querySelector(".stage-title");o&&o.classList.remove("hidden");const n=t?"NEW HIGH SCORE!":"GAME OVER";document.dispatchEvent(new CustomEvent("showGameOver",{detail:{title:n,score:ve.score,foodEaten:ve.foodCollected,coinsEarned:e,highScore:ve.highScore,isNewHighScore:t}}))}());zt()});
